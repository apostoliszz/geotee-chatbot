version: "3.1"

stories:
  # Story: Happy path - terms accepted and FAQ
  - story: User accepts terms and asks FAQ
    steps:
      - intent: greet
      - action: action_check_terms
      - slot_was_set:
          - terms_accepted: false
      - action: utter_terms_of_service
      - intent: accept_terms
      - action: action_check_terms
      - action: utter_terms_accepted
      - intent: faq
      - action: action_check_rate_limit
      - slot_was_set:
          - rate_limited: false
      - action: action_search_knowledge_base
      - intent: thank
      - action: utter_thank
      - intent: goodbye
      - action: utter_goodbye

  # Story: User asks general info
  - story: User asks for general information
    steps:
      - intent: greet
      - action: action_check_terms
      - slot_was_set:
          - terms_accepted: true
      - action: utter_greet
      - intent: ask_general_info
      - action: action_check_rate_limit
      - slot_was_set:
          - rate_limited: false
      - action: action_search_knowledge_base
      - intent: goodbye
      - action: utter_goodbye

  # Story: Rate limit reached
  - story: User reaches rate limit
    steps:
      - intent: ask_general_info
      - action: action_check_rate_limit
      - slot_was_set:
          - rate_limited: true
      - action: utter_rate_limit_exceeded

  # Story: Multiple questions in session
  - story: User asks multiple questions
    steps:
      - intent: greet
      - action: action_check_terms
      - slot_was_set:
          - terms_accepted: true
      - action: utter_greet
      - intent: faq
      - action: action_check_rate_limit
      - action: action_search_knowledge_base
      - intent: ask_general_info
      - action: action_check_rate_limit
      - action: action_search_knowledge_base
      - intent: faq
      - action: action_check_rate_limit
      - action: action_search_knowledge_base
      - intent: thank
      - action: utter_thank

  # Story: User declines terms
  - story: User declines terms of service
    steps:
      - intent: greet
      - action: action_check_terms
      - slot_was_set:
          - terms_accepted: false
      - action: utter_terms_of_service
      - intent: decline_terms
      - action: utter_terms_declined

  # Story: User asks for help
  - story: User needs help
    steps:
      - intent: help
      - action: utter_help
      - intent: faq
      - action: action_check_rate_limit
      - action: action_search_knowledge_base

  # Story: User asks in English
  - story: English query rejection
    steps:
      - intent: english_query
      - action: action_detect_language
      - action: utter_english_not_supported
      - intent: greet
      - action: utter_greet

  # Story: Out of scope question
  - story: User asks out of scope question
    steps:
      - intent: greet
      - action: action_check_terms
      - action: utter_greet
      - intent: out_of_scope
      - action: utter_out_of_scope
      - intent: faq
      - action: action_check_rate_limit
      - action: action_search_knowledge_base

  # Story: User continues after reaching limit
  - story: User continues after rate limit
    steps:
      - intent: faq
      - action: action_check_rate_limit
      - slot_was_set:
          - rate_limited: true
      - action: utter_rate_limit_exceeded
      - intent: thank
      - action: utter_thank
      - intent: goodbye
      - action: utter_goodbye
