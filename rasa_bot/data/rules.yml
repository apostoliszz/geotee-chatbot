version: "3.1"

rules:
  # Rule: Greet user
  - rule: Respond to greeting
    steps:
      - intent: greet
      - action: action_check_terms
      - slot_was_set:
          - terms_accepted: false
      - action: utter_terms_of_service

  # Rule: Terms accepted
  - rule: User accepts terms
    steps:
      - intent: accept_terms
      - action: action_check_terms
      - action: utter_terms_accepted

  # Rule: Terms declined
  - rule: User declines terms
    steps:
      - intent: decline_terms
      - action: utter_terms_declined

  # Rule: Say goodbye
  - rule: Say goodbye anytime
    condition:
      - slot_was_set:
          - terms_accepted: true
    steps:
      - intent: goodbye
      - action: utter_goodbye

  # Rule: Respond to thanks
  - rule: Respond to thanks
    condition:
      - slot_was_set:
          - terms_accepted: true
    steps:
      - intent: thank
      - action: utter_thank

  # Rule: Bot challenge
  - rule: Respond to bot challenge
    steps:
      - intent: bot_challenge
      - action: utter_iamabot

  # Rule: Help request
  - rule: Provide help
    steps:
      - intent: help
      - action: utter_help

  # Rule: English query rejection
  - rule: Reject English queries
    steps:
      - intent: english_query
      - action: action_detect_language
      - action: utter_english_not_supported

  # Rule: Out of scope
  - rule: Handle out of scope
    condition:
      - slot_was_set:
          - terms_accepted: true
    steps:
      - intent: out_of_scope
      - action: utter_out_of_scope

  # Rule: Rate limit check before any action
  - rule: Check rate limit before processing
    condition:
      - slot_was_set:
          - terms_accepted: true
    steps:
      - intent: ask_general_info
      - action: action_check_rate_limit

  - rule: Check rate limit for FAQ
    condition:
      - slot_was_set:
          - terms_accepted: true
    steps:
      - intent: faq
      - action: action_check_rate_limit

  # Rule: Fallback
  - rule: Default fallback
    steps:
      - intent: nlu_fallback
      - action: action_default_fallback
